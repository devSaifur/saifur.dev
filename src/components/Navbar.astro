<nav
  class='sticky z-50 hidden w-full list-none justify-center gap-x-28 pt-4 text-lg font-semibold text-sky-200/95 md:flex'
>
  <ul
    class='relative my-auto flex gap-x-16 rounded-lg bg-stone-900 px-8 py-3 shadow-[0_10px_20px_rgba(15,_118,_110,_0.7)]'
  >
    <li class='nav-link z-20 cursor-pointer rounded-xl px-5 py-1'>
      <a href='/'>Home</a>
    </li>
    <li class='nav-link z-20 cursor-pointer rounded-xl px-5 py-1'>
      <a href='/blogs'>Blogs</a>
    </li>
    <li class='nav-link z-20 cursor-pointer rounded-xl px-5 py-1'>
      <a href='/projects'>Projects</a>
    </li>
    <div
      id='background-slide'
      class='absolute left-0 top-2.5 h-4/6 rounded-lg bg-teal-700 transition-all delay-150 duration-300 ease-in-out'
    >
    </div>
  </ul>
</nav>

<script>
  document.addEventListener('astro:page-load', () => {
    const navLinks = document.querySelectorAll('.nav-link')
    const backgroundSlide = document.getElementById('background-slide')

    let activeLink: Element | null = null

    const updateBackgroundPosition = (link: Element) => {
      const linkRect = link.getBoundingClientRect()
      const navRect = link.parentElement!.getBoundingClientRect()

      if (!backgroundSlide) return

      backgroundSlide.style.width = `${linkRect.width}px`
      backgroundSlide.style.transform = `translateX(${linkRect.left - navRect.left}px)`
    }

    const setActiveLink = (link: Element) => {
      if (activeLink) {
        activeLink.classList.remove('text-white')
      }
      activeLink = link
      activeLink.classList.add('text-white')
      updateBackgroundPosition(link)
    }

    const currentPath = window.location.pathname

    const initialActiveLink = Array.from(navLinks).find(
      (link) => link.querySelector('a')?.getAttribute('href') === currentPath
    )

    if (initialActiveLink) {
      setActiveLink(initialActiveLink)
    } else if (typeof navLinks[0] !== 'undefined') {
      setActiveLink(navLinks[0])
    }

    navLinks.forEach((link) => {
      link.addEventListener('mouseenter', () => {
        updateBackgroundPosition(link)
      })

      link.addEventListener('mouseleave', () => {
        if (activeLink) {
          updateBackgroundPosition(activeLink)
        }
      })

      link.addEventListener('click', () => {
        setActiveLink(link)
      })
    })
  })
</script>
